<!DOCTYPE HTML>
<html><head><style type="text/css">/*Copyright2019GoogleLLC*//**//*UseofthissourcecodeisgovernedbyaBSD-style*//*licensethatcanbefoundintheLICENSEfileorat*//*https://developers.google.com/open-source/licenses/bsd*/body{margin:1emauto1emauto;padding:1em1em1em1em;max-width:50em;font-family:Helvetica,sans-serif;font-size:100%;color:#333;padding-bottom:500px;}.cell{}.code-block,.err-block,.result-block{padding:0em0em0em2em;display:block;font-family:monospace;white-space:pre;}code{background-color:#F0F0F0;}.result-block{border-left:3pxsolid#87CEFA;}.prose-block{line-height:140%;}.err-block{font-weight:bold;color:#B22222;border-left:3pxsolid#B22222;}.plot{padding:5em;}.plot-img{width:80%;}.comment{color:#808080;}.keyword{color:#0000DD;}.command{color:#A80000;}.symbol{color:#E07000;}.type-name{color:#A80000;}.iso-sugar{color:#25BBA7;}</style><meta charset="UTF-8"></head><body><div id="main-output"><div class="cell"><div class="prose-block"><h1>Vector graphics library</h1>
</div></div><div class="cell"><div class="code-block"><span class="type-name">Point</span> <span class="symbol">:</span> <span class="type-name">Type</span> <span class="symbol">=</span> (<span class="type-name">Float</span> <span class="symbol">&amp;</span> <span class="type-name">Float</span>)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">data</span> <span class="type-name">Geom</span> <span class="symbol">=</span>
  <span class="type-name">PointGeom</span>
  <span class="type-name">Circle</span> <span class="type-name">Float</span>
  <span class="type-name">Rectangle</span> <span class="type-name">Float</span> <span class="type-name">Float</span>  <span class="comment">-- width, height
</span>  <span class="type-name">Line</span> <span class="type-name">Point</span>
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- HTML color (no alpha)
</span></div></div><div class="cell"><div class="code-block"><span class="comment">-- TODO: replace with `Fin 3 =&gt; Word8` when we fix #348
</span></div></div><div class="cell"><div class="code-block"><span class="type-name">HtmlColor</span> <span class="symbol">:</span> <span class="type-name">Type</span> <span class="symbol">=</span> (<span class="type-name">Word8</span> <span class="symbol">&amp;</span> <span class="type-name">Word8</span> <span class="symbol">&amp;</span> <span class="type-name">Word8</span>)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> showHex (x<span class="symbol">:</span><span class="type-name">Int32</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span> unsafeIO <span class="symbol">\</span>()<span class="symbol">.</span>
  (n<span class="symbol">,</span> ptr) <span class="symbol">=</span> %ffi showHex (<span class="type-name">Int32</span> <span class="symbol">&amp;</span> <span class="type-name">RawPtr</span>) x
  stringFromCharPtr n (<span class="type-name">MkPtr</span> ptr)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">black <span class="symbol">:</span> <span class="type-name">HtmlColor</span> <span class="symbol">=</span> (<span class="type-name">IToW8</span>   0<span class="symbol">,</span> <span class="type-name">IToW8</span>   0<span class="symbol">,</span> <span class="type-name">IToW8</span>   0)
</div></div><div class="cell"><div class="code-block">white <span class="symbol">:</span> <span class="type-name">HtmlColor</span> <span class="symbol">=</span> (<span class="type-name">IToW8</span> 255<span class="symbol">,</span> <span class="type-name">IToW8</span> 255<span class="symbol">,</span> <span class="type-name">IToW8</span> 255)
</div></div><div class="cell"><div class="code-block">red   <span class="symbol">:</span> <span class="type-name">HtmlColor</span> <span class="symbol">=</span> (<span class="type-name">IToW8</span> 255<span class="symbol">,</span> <span class="type-name">IToW8</span>   0<span class="symbol">,</span> <span class="type-name">IToW8</span>   0)
</div></div><div class="cell"><div class="code-block">green <span class="symbol">:</span> <span class="type-name">HtmlColor</span> <span class="symbol">=</span> (<span class="type-name">IToW8</span>   0<span class="symbol">,</span> <span class="type-name">IToW8</span> 255<span class="symbol">,</span> <span class="type-name">IToW8</span>   0)
</div></div><div class="cell"><div class="code-block">blue  <span class="symbol">:</span> <span class="type-name">HtmlColor</span> <span class="symbol">=</span> (<span class="type-name">IToW8</span>   0<span class="symbol">,</span> <span class="type-name">IToW8</span>   0<span class="symbol">,</span> <span class="type-name">IToW8</span> 255)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="type-name">GeomStyle</span> <span class="symbol">:</span> <span class="type-name">Type</span> <span class="symbol">=</span>
  { fillColor   <span class="symbol">:</span> <span class="type-name">Maybe</span> <span class="type-name">HtmlColor</span>
  <span class="symbol">&amp;</span> strokeColor <span class="symbol">:</span> <span class="type-name">Maybe</span> <span class="type-name">HtmlColor</span>
  <span class="symbol">&amp;</span> strokeWidth <span class="symbol">:</span> <span class="type-name">Int</span> }
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">defaultGeomStyle <span class="symbol">:</span> <span class="type-name">GeomStyle</span> <span class="symbol">=</span>
  { fillColor   <span class="symbol">=</span> <span class="type-name">Nothing</span>
  <span class="symbol">,</span> strokeColor <span class="symbol">=</span> <span class="type-name">Just</span> black
  <span class="symbol">,</span> strokeWidth <span class="symbol">=</span> 1 }
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- TODO: consider sharing attributes among a set of objects for efficiency
</span></div></div><div class="cell"><div class="code-block"><span class="keyword">data</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> <span class="type-name">MkDiagram</span> (<span class="type-name">List</span> (<span class="type-name">GeomStyle</span> <span class="symbol">&amp;</span> <span class="type-name">Point</span> <span class="symbol">&amp;</span> <span class="type-name">Geom</span>))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">instance</span> monoidDiagram <span class="symbol">:</span> <span class="type-name">Monoid</span> <span class="type-name">Diagram</span> <span class="keyword">where</span>
  mempty <span class="symbol">=</span> <span class="type-name">MkDiagram</span> mempty
  mcombine <span class="symbol">=</span> <span class="symbol">\</span>(<span class="type-name">MkDiagram</span> d1) (<span class="type-name">MkDiagram</span> d2)<span class="symbol">.</span> <span class="type-name">MkDiagram</span> <span class="symbol">$</span> d1 <span class="symbol">&lt;&gt;</span> d2
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> concatDiagrams (diagrams<span class="command">:n</span><span class="symbol">=&gt;</span><span class="type-name">Diagram</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span>
  <span class="type-name">MkDiagram</span> <span class="symbol">$</span> concat <span class="keyword">for</span> i<span class="symbol">.</span>
    (<span class="type-name">MkDiagram</span> d) <span class="symbol">=</span> diagrams<span class="symbol">.</span>i
    d
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- TODO: arbitrary affine transformations. Our current representation of
</span></div></div><div class="cell"><div class="code-block"><span class="comment">-- rectangles and circles means we can only do scale/flip/rotate90.
</span></div></div><div class="cell"><div class="code-block"><span class="comment">-- Should we use lenses/isomorphisms for these instead?
</span></div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> applyTransformation
      (transformPoint<span class="symbol">:</span> <span class="type-name">Point</span> <span class="symbol">-&gt;</span> <span class="type-name">Point</span>)
      (transformGeom<span class="symbol">:</span>  <span class="type-name">Geom</span> <span class="symbol">-&gt;</span> <span class="type-name">Geom</span>)
      (d<span class="symbol">:</span><span class="type-name">Diagram</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span>
  (<span class="type-name">MkDiagram</span> (<span class="type-name">AsList</span> _ objs)) <span class="symbol">=</span> d
  <span class="type-name">MkDiagram</span> <span class="symbol">$</span> toList <span class="keyword">for</span> i<span class="symbol">.</span>
    (attr<span class="symbol">,</span> p<span class="symbol">,</span> geom) <span class="symbol">=</span> objs<span class="symbol">.</span>i
    (attr<span class="symbol">,</span> transformPoint p<span class="symbol">,</span> transformGeom geom)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">flipY <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span>
  applyTransformation (<span class="symbol">\</span>(x<span class="symbol">,</span>y)<span class="symbol">.</span> (x<span class="symbol">,</span> <span class="symbol">-</span>y)) <span class="symbol">\</span>geom<span class="symbol">.</span> <span class="keyword">case</span> geom <span class="keyword">of</span>
    <span class="type-name">PointGeom</span>     <span class="symbol">-&gt;</span> <span class="type-name">PointGeom</span>
    <span class="type-name">Circle</span> r      <span class="symbol">-&gt;</span> <span class="type-name">Circle</span> r
    <span class="type-name">Rectangle</span> w h <span class="symbol">-&gt;</span> <span class="type-name">Rectangle</span> w h
    <span class="type-name">Line</span> (x<span class="symbol">,</span> y)   <span class="symbol">-&gt;</span> <span class="type-name">Line</span> (x<span class="symbol">,</span> <span class="symbol">-</span>y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> scale (s<span class="symbol">:</span><span class="type-name">Float</span>) <span class="symbol">:</span> (<span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span>) <span class="symbol">=</span>
  applyTransformation ( <span class="symbol">\</span>(x<span class="symbol">,</span>y)<span class="symbol">.</span> (s <span class="symbol">*</span> x<span class="symbol">,</span> s <span class="symbol">*</span> y) ) <span class="symbol">\</span>geom<span class="symbol">.</span> <span class="keyword">case</span> geom <span class="keyword">of</span>
    <span class="type-name">PointGeom</span>     <span class="symbol">-&gt;</span> <span class="type-name">PointGeom</span>
    <span class="type-name">Circle</span> r      <span class="symbol">-&gt;</span> <span class="type-name">Circle</span> (s <span class="symbol">*</span> r)
    <span class="type-name">Rectangle</span> w h <span class="symbol">-&gt;</span> <span class="type-name">Rectangle</span> (s <span class="symbol">*</span> w) (s <span class="symbol">*</span> h)
    <span class="type-name">Line</span> (x<span class="symbol">,</span> y)   <span class="symbol">-&gt;</span> <span class="type-name">Line</span> (s <span class="symbol">*</span> x<span class="symbol">,</span> s <span class="symbol">*</span> y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> moveXY ((offX<span class="symbol">,</span> offY) <span class="symbol">:</span> <span class="type-name">Point</span>) <span class="symbol">:</span> (<span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span>) <span class="symbol">=</span>
  applyTransformation (<span class="symbol">\</span>(x<span class="symbol">,</span>y)<span class="symbol">.</span> (x <span class="symbol">+</span> offX<span class="symbol">,</span> y <span class="symbol">+</span> offY) ) id
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> singletonDefault (geom<span class="symbol">:</span><span class="type-name">Geom</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span>
  <span class="type-name">MkDiagram</span> <span class="symbol">$</span> toList [(defaultGeomStyle<span class="symbol">,</span> (0<span class="symbol">.</span>0<span class="symbol">,</span> 0<span class="symbol">.</span>0)<span class="symbol">,</span> geom)]
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> pointDiagram               <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> singletonDefault <span class="type-name">PointGeom</span>
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> circle (r<span class="symbol">:</span><span class="type-name">Float</span>)           <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> singletonDefault <span class="symbol">$</span> <span class="type-name">Circle</span> r
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> rect   (w<span class="symbol">:</span><span class="type-name">Float</span>) (h<span class="symbol">:</span><span class="type-name">Float</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> singletonDefault <span class="symbol">$</span> <span class="type-name">Rectangle</span> w h
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> line   (p<span class="symbol">:</span><span class="type-name">Point</span>)           <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> singletonDefault <span class="symbol">$</span> <span class="type-name">Line</span> p
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> updateGeom (update<span class="symbol">:</span> <span class="type-name">GeomStyle</span> <span class="symbol">-&gt;</span> <span class="type-name">GeomStyle</span>) (d<span class="symbol">:</span><span class="type-name">Diagram</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">=</span>
  (<span class="type-name">MkDiagram</span> (<span class="type-name">AsList</span> _ objs)) <span class="symbol">=</span> d
  <span class="type-name">MkDiagram</span> <span class="symbol">$</span> toList <span class="keyword">for</span> i<span class="symbol">.</span>
    (attr       <span class="symbol">,</span> geoms) <span class="symbol">=</span> objs<span class="symbol">.</span>i
    (update attr<span class="symbol">,</span> geoms)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> setFillColor   (c<span class="symbol">:</span><span class="type-name">HtmlColor</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> updateGeom <span class="symbol">$</span> setAt <span class="iso-sugar">#fillColor</span>   (<span class="type-name">Just</span> c)
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> setStrokeColor (c<span class="symbol">:</span><span class="type-name">HtmlColor</span>) <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> updateGeom <span class="symbol">$</span> setAt <span class="iso-sugar">#strokeColor</span> (<span class="type-name">Just</span> c)
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> setStrokeWidth (w<span class="symbol">:</span><span class="type-name">Int</span>)       <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> updateGeom <span class="symbol">$</span> setAt <span class="iso-sugar">#strokeWidth</span> w
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> removeStroke                 <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> updateGeom <span class="symbol">$</span> setAt <span class="iso-sugar">#strokeColor</span> <span class="type-name">Nothing</span>
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> removeFill                   <span class="symbol">:</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> updateGeom <span class="symbol">$</span> setAt <span class="iso-sugar">#fillColor</span>   <span class="type-name">Nothing</span>
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><h2>Serialization to SVG string</h2>
</div></div><div class="cell"><div class="prose-block"><p>Non-inlinable versions to improve compile times. (Non-inlined functions have to be monomorphic right now).</p>
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>noinline
<span class="keyword">def</span> strCatUncurried ((xs<span class="symbol">,</span>ys)<span class="symbol">:</span>(<span class="type-name">String</span> <span class="symbol">&amp;</span> <span class="type-name">String</span>)) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span> xs <span class="symbol">&lt;&gt;</span> ys
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> (<span class="symbol">&lt;.&gt;</span>) (xs<span class="symbol">:</span><span class="type-name">String</span>) (ys<span class="symbol">:</span><span class="type-name">String</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span> strCatUncurried (xs<span class="symbol">,</span> ys)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> quote (s<span class="symbol">:</span><span class="type-name">String</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span> &quot;<span class="symbol">\</span>&quot;&quot; <span class="symbol">&lt;.&gt;</span> s <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">\</span>&quot;&quot;
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>noinline
<span class="keyword">def</span> strSpaceCatUncurried ((s1<span class="symbol">,</span>s2)<span class="symbol">:</span>(<span class="type-name">String</span> <span class="symbol">&amp;</span> <span class="type-name">String</span>)) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  s1 <span class="symbol">&lt;.&gt;</span> &quot; &quot; <span class="symbol">&lt;.&gt;</span> s2
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> (<span class="symbol">&lt;+&gt;</span>) (_<span class="symbol">:</span><span class="type-name">Show</span> a) <span class="symbol">?=&gt;</span> (_<span class="symbol">:</span><span class="type-name">Show</span> b) <span class="symbol">?=&gt;</span> (s1<span class="command">:a</span>) (s2<span class="command">:b</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  strSpaceCatUncurried ((show s1)<span class="symbol">,</span> (show s2))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> selfClosingBrackets (s<span class="symbol">:</span><span class="type-name">String</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span> &quot;<span class="symbol">&lt;</span>&quot; <span class="symbol">&lt;.&gt;</span> s <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">/&gt;</span>&quot;
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> tagBrackets (tag<span class="symbol">:</span><span class="type-name">String</span>) (s<span class="symbol">:</span><span class="type-name">String</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  &quot;<span class="symbol">&lt;</span>&quot; <span class="symbol">&lt;.&gt;</span> tag <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">&gt;</span>&quot; <span class="symbol">&lt;.&gt;</span> s <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">&lt;/</span>&quot; <span class="symbol">&lt;.&gt;</span> tag <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">&gt;</span>&quot;
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>noinline
<span class="keyword">def</span> tagBracketsAttrUncurried ((tag<span class="symbol">,</span> attr<span class="symbol">,</span> s)<span class="symbol">:</span>(<span class="type-name">String</span> <span class="symbol">&amp;</span> <span class="type-name">String</span> <span class="symbol">&amp;</span> <span class="type-name">String</span>)) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  &quot;<span class="symbol">&lt;</span>&quot; <span class="symbol">&lt;.&gt;</span> tag <span class="symbol">&lt;+&gt;</span> attr <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">&gt;</span>&quot; <span class="symbol">&lt;.&gt;</span> s <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">&lt;/</span>&quot; <span class="symbol">&lt;.&gt;</span> tag <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">&gt;</span>&quot;
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> tagBracketsAttr (tag<span class="symbol">:</span><span class="type-name">String</span>) (attr<span class="symbol">:</span><span class="type-name">String</span>) (s<span class="symbol">:</span><span class="type-name">String</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  tagBracketsAttrUncurried (tag<span class="symbol">,</span> attr<span class="symbol">,</span> s)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> (<span class="symbol">&lt;=&gt;</span>) (_<span class="symbol">:</span><span class="type-name">Show</span> b) <span class="symbol">?=&gt;</span> (attr<span class="symbol">:</span><span class="type-name">String</span>) (val<span class="command">:b</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  attr <span class="symbol">&lt;.&gt;</span> &quot;<span class="symbol">=</span>&quot; <span class="symbol">&lt;.&gt;</span> quote (show val)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> htmlColor(cs<span class="symbol">:</span><span class="type-name">HtmlColor</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  (r<span class="symbol">,</span> g<span class="symbol">,</span> b) <span class="symbol">=</span> cs
  &quot;#&quot; <span class="symbol">&lt;&gt;</span> (showHex <span class="symbol">$</span> <span class="type-name">W8ToI</span> r) <span class="symbol">&lt;&gt;</span> (showHex <span class="symbol">$</span> <span class="type-name">W8ToI</span> g) <span class="symbol">&lt;&gt;</span> (showHex <span class="symbol">$</span> <span class="type-name">W8ToI</span> b)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> optionalHtmlColor(c<span class="symbol">:</span> <span class="type-name">Maybe</span> <span class="type-name">HtmlColor</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  <span class="keyword">case</span> c <span class="keyword">of</span>
    <span class="type-name">Nothing</span> <span class="symbol">-&gt;</span> &quot;none&quot;
    <span class="type-name">Just</span> c&#39; <span class="symbol">-&gt;</span> htmlColor c&#39;
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="symbol">@</span>noinline
<span class="keyword">def</span> attrString (attr<span class="symbol">:</span><span class="type-name">GeomStyle</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  (  <span class="comment">-- &quot;stroke&quot;      &lt;=&gt; (optionalHtmlColor $ getAt #strokeColor attr)
</span>      (&quot;fill&quot;         <span class="symbol">&lt;=&gt;</span> (optionalHtmlColor <span class="symbol">$</span> getAt <span class="iso-sugar">#fillColor</span>   attr))
  <span class="symbol">&lt;+&gt;</span> (&quot;stroke<span class="symbol">-</span>width&quot; <span class="symbol">&lt;=&gt;</span> (getAt <span class="iso-sugar">#strokeWidth</span> attr)))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> renderGeom (attr<span class="symbol">:</span><span class="type-name">GeomStyle</span>) ((x<span class="symbol">,</span>y)<span class="symbol">:</span><span class="type-name">Point</span>) (geom<span class="symbol">:</span><span class="type-name">Geom</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  groupEle <span class="symbol">=</span> <span class="symbol">\</span>attr<span class="symbol">.</span> tagBracketsAttr &quot;g&quot; (attrString attr)
  <span class="keyword">case</span> geom <span class="keyword">of</span>
    <span class="type-name">PointGeom</span> <span class="symbol">-&gt;</span>
      pointAttr <span class="symbol">=</span> setAt <span class="iso-sugar">#fillColor</span> (getAt <span class="iso-sugar">#strokeColor</span> attr) attr
      groupEle pointAttr <span class="symbol">$</span> selfClosingBrackets <span class="symbol">$</span>
        (&quot;circle&quot; <span class="symbol">&lt;+&gt;</span>
         &quot;cx&quot; <span class="symbol">&lt;=&gt;</span> x <span class="symbol">&lt;.&gt;</span>
         &quot;cy&quot; <span class="symbol">&lt;=&gt;</span> y <span class="symbol">&lt;.&gt;</span>
         &quot;r<span class="symbol">=\</span>&quot;1<span class="symbol">\</span>&quot;&quot;)
    <span class="type-name">Circle</span> r <span class="symbol">-&gt;</span>
      groupEle attr <span class="symbol">$</span> selfClosingBrackets <span class="symbol">$</span>
        (&quot;circle&quot; <span class="symbol">&lt;+&gt;</span>
         &quot;cx&quot; <span class="symbol">&lt;=&gt;</span> x <span class="symbol">&lt;.&gt;</span>
         &quot;cy&quot; <span class="symbol">&lt;=&gt;</span> y <span class="symbol">&lt;.&gt;</span>
         &quot;r&quot;  <span class="symbol">&lt;=&gt;</span> r)
    <span class="type-name">Rectangle</span> w h <span class="symbol">-&gt;</span>
      groupEle attr <span class="symbol">$</span> selfClosingBrackets <span class="symbol">$</span>
        (&quot;rect&quot; <span class="symbol">&lt;+&gt;</span>
         &quot;width&quot;  <span class="symbol">&lt;=&gt;</span> w <span class="symbol">&lt;.&gt;</span>
         &quot;height&quot; <span class="symbol">&lt;=&gt;</span> h <span class="symbol">&lt;.&gt;</span>
         &quot;x&quot;      <span class="symbol">&lt;=&gt;</span> (x <span class="symbol">-</span> (w<span class="symbol">/</span>2<span class="symbol">.</span>0)) <span class="symbol">&lt;.&gt;</span>
         &quot;y&quot;      <span class="symbol">&lt;=&gt;</span> (y <span class="symbol">-</span> (h<span class="symbol">/</span>2<span class="symbol">.</span>0)))
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="type-name">BoundingBox</span> <span class="symbol">:</span> <span class="type-name">Type</span> <span class="symbol">=</span> (<span class="type-name">Point</span> <span class="symbol">&amp;</span> <span class="type-name">Point</span>)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> renderSVG (d<span class="symbol">:</span><span class="type-name">Diagram</span>) (bounds<span class="symbol">:</span><span class="type-name">BoundingBox</span>) <span class="symbol">:</span> <span class="type-name">String</span> <span class="symbol">=</span>
  ((xmin<span class="symbol">,</span> ymin)<span class="symbol">,</span> (xmax<span class="symbol">,</span> ymax)) <span class="symbol">=</span> bounds
  imgWidth <span class="symbol">=</span> 400<span class="symbol">.</span>0
  scaleFactor <span class="symbol">=</span> imgWidth <span class="symbol">/</span> (xmax <span class="symbol">-</span> xmin)
  imgHeight <span class="symbol">=</span> (ymax <span class="symbol">-</span> ymin) <span class="symbol">*</span> scaleFactor
  imgXMin   <span class="symbol">=</span>  xmin <span class="symbol">*</span> scaleFactor
  imgYMin   <span class="symbol">=</span> <span class="symbol">-</span>ymax <span class="symbol">*</span> scaleFactor
  (<span class="type-name">MkDiagram</span> (<span class="type-name">AsList</span> _ objs)) <span class="symbol">=</span> d <span class="symbol">|&gt;</span> flipY <span class="symbol">|&gt;</span> scale scaleFactor
  svgAttrStr <span class="symbol">=</span> (    &quot;width&quot;   <span class="symbol">&lt;=&gt;</span> imgWidth
                <span class="symbol">&lt;+&gt;</span> &quot;height&quot;  <span class="symbol">&lt;=&gt;</span> imgHeight
                <span class="symbol">&lt;+&gt;</span> &quot;viewBox&quot; <span class="symbol">&lt;=&gt;</span> (imgXMin <span class="symbol">&lt;+&gt;</span> imgYMin <span class="symbol">&lt;+&gt;</span> imgWidth <span class="symbol">&lt;+&gt;</span> imgHeight))
  tagBracketsAttr &quot;svg&quot; svgAttrStr <span class="symbol">$</span>
    concat <span class="keyword">for</span> i<span class="symbol">.</span>
      (attr<span class="symbol">,</span> pos<span class="symbol">,</span> geom) <span class="symbol">=</span> objs<span class="symbol">.</span>i
      renderGeom attr pos geom
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><h2>Derived convenience methods and combinators</h2>
</div></div><div class="cell"><div class="code-block">moveX <span class="symbol">:</span> <span class="type-name">Float</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> <span class="symbol">\</span>x<span class="symbol">.</span> moveXY (x<span class="symbol">,</span> 0<span class="symbol">.</span>0)
</div></div><div class="cell"><div class="code-block">moveY <span class="symbol">:</span> <span class="type-name">Float</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">-&gt;</span> <span class="type-name">Diagram</span> <span class="symbol">=</span> <span class="symbol">\</span>y<span class="symbol">.</span> moveXY (0<span class="symbol">.</span>0<span class="symbol">,</span> y)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- mydiagram : Diagram =
</span></div></div><div class="cell"><div class="code-block"><span class="comment">--   (  (circle 7.0 |&gt; moveXY (20.0, 20.0) |&gt; setFillColor blue |&gt; setStrokeColor red)
</span></div></div><div class="cell"><div class="code-block"><span class="comment">--   &lt;&gt; (circle 5.0 |&gt; moveXY (40.0, 40.0))
</span></div></div><div class="cell"><div class="code-block"><span class="comment">--   &lt;&gt; (rect  10.0 20.0 |&gt; moveXY (5.0, 10.0) |&gt; setStrokeColor red)
</span></div></div><div class="cell"><div class="code-block"><span class="comment">--   &lt;&gt; (pointDiagram |&gt; moveXY (15.0, 5.0) |&gt; setStrokeColor red)
</span></div></div><div class="cell"><div class="code-block"><span class="comment">--   )
</span></div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- :html renderSVG mydiagram ((0.0, 0.0), (100.0, 50.0))
</span></div></div></div></body></html>