<!DOCTYPE HTML>
<html><head><style type="text/css">/*Copyright2019GoogleLLC*//**//*UseofthissourcecodeisgovernedbyaBSD-style*//*licensethatcanbefoundintheLICENSEfileorat*//*https://developers.google.com/open-source/licenses/bsd*/body{margin:1emauto1emauto;padding:1em1em1em1em;max-width:50em;font-family:Helvetica,sans-serif;font-size:100%;color:#333;padding-bottom:500px;}.cell{}.code-block,.err-block,.result-block{padding:0em0em0em2em;display:block;font-family:monospace;white-space:pre;}code{background-color:#F0F0F0;}.result-block{border-left:3pxsolid#87CEFA;}.prose-block{line-height:140%;}.err-block{font-weight:bold;color:#B22222;border-left:3pxsolid#B22222;}.plot{padding:5em;}.plot-img{width:80%;}.comment{color:#808080;}.keyword{color:#0000DD;}.command{color:#A80000;}.symbol{color:#E07000;}.type-name{color:#A80000;}.iso-sugar{color:#25BBA7;}</style><meta charset="UTF-8"></head><body><div id="main-output"><div class="cell"><div class="prose-block"><h2>Fluid sim</h2>
<p>Fluid simulation code based on
<a href="https://www.josstam.com/publications">Real-Time Fluid Dynamics for Games</a> by Jos Stam</p>
</div></div><div class="cell"><div class="code-block">include &quot;plot<span class="symbol">.</span>dx&quot;
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> wrapidx (n<span class="symbol">:</span><span class="type-name">Type</span>) <span class="symbol">-&gt;</span> (i<span class="symbol">:</span><span class="type-name">Int</span>) <span class="symbol">:</span> n <span class="symbol">=</span>
  <span class="comment">-- Index wrapping around at ends.
</span>  asidx <span class="symbol">$</span> mod i <span class="symbol">$</span> size n
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> incwrap (i<span class="command">:n</span>) <span class="symbol">:</span> n <span class="symbol">=</span>  <span class="comment">-- Increment index, wrapping around at ends.
</span>  asidx <span class="symbol">$</span> mod ((ordinal i) <span class="symbol">+</span> 1) <span class="symbol">$</span> size n
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> decwrap (i<span class="command">:n</span>) <span class="symbol">:</span> n <span class="symbol">=</span>  <span class="comment">-- Decrement index, wrapping around at ends.
</span>  asidx <span class="symbol">$</span> mod ((ordinal i) <span class="symbol">-</span> 1) <span class="symbol">$</span> size n
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> finite_difference_neighbours (_<span class="symbol">:</span><span class="type-name">Add</span> a) <span class="symbol">?=&gt;</span> (x<span class="command">:n</span><span class="symbol">=&gt;</span>a) <span class="symbol">:</span> n<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  <span class="keyword">for</span> i<span class="symbol">.</span> x<span class="symbol">.</span>(incwrap i) <span class="symbol">-</span> x<span class="symbol">.</span>(decwrap i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> add_neighbours (_<span class="symbol">:</span><span class="type-name">Add</span> a) <span class="symbol">?=&gt;</span> (x<span class="command">:n</span><span class="symbol">=&gt;</span>a) <span class="symbol">:</span> n<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  <span class="keyword">for</span> i<span class="symbol">.</span> x<span class="symbol">.</span>(incwrap i) <span class="symbol">+</span> x<span class="symbol">.</span>(decwrap i)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> apply_along_axis1 (f<span class="command">:b</span><span class="symbol">=&gt;</span>a <span class="symbol">-&gt;</span> b<span class="symbol">=&gt;</span>a) (x<span class="command">:b</span><span class="symbol">=&gt;</span>c<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> b<span class="symbol">=&gt;</span>c<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  transpose <span class="keyword">for</span> j<span class="symbol">.</span> f <span class="keyword">for</span> i<span class="symbol">.</span> x<span class="symbol">.</span>i<span class="symbol">.</span>j
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> apply_along_axis2 (f<span class="command">:c</span><span class="symbol">=&gt;</span>a <span class="symbol">-&gt;</span> c<span class="symbol">=&gt;</span>a) (x<span class="command">:b</span><span class="symbol">=&gt;</span>c<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> b<span class="symbol">=&gt;</span>c<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  <span class="keyword">for</span> i<span class="symbol">.</span> f x<span class="symbol">.</span>i
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> fdx (_<span class="symbol">:</span><span class="type-name">Add</span> a) <span class="symbol">?=&gt;</span> (x<span class="command">:n</span><span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> (n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">=</span>
  apply_along_axis1 finite_difference_neighbours x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> fdy (_<span class="symbol">:</span><span class="type-name">Add</span> a) <span class="symbol">?=&gt;</span> (x<span class="command">:n</span><span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> (n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">=</span>
  apply_along_axis2 finite_difference_neighbours x
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> divergence (_<span class="symbol">:</span><span class="type-name">Add</span> a) <span class="symbol">?=&gt;</span> (vx<span class="command">:n</span><span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) (vy<span class="command">:n</span><span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> (n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">=</span>
  fdx vx <span class="symbol">+</span> fdy vy
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> add_neighbours_2d (_<span class="symbol">:</span><span class="type-name">Add</span> a) <span class="symbol">?=&gt;</span> (x<span class="command">:n</span><span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> (n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) <span class="symbol">=</span>
  ax1 <span class="symbol">=</span> apply_along_axis1 add_neighbours x
  ax2 <span class="symbol">=</span> apply_along_axis2 add_neighbours x
  ax1 <span class="symbol">+</span> ax2
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> project (_<span class="symbol">:</span><span class="type-name">VSpace</span> a) <span class="symbol">?=&gt;</span> (v<span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>(<span class="type-name">Fin</span> 2)<span class="symbol">=&gt;</span>a) <span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>(<span class="type-name">Fin</span> 2)<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  <span class="comment">-- Project the velocity field to be approximately mass-conserving,
</span>  <span class="comment">-- using a few iterations of Gauss-Seidel.
</span>  h <span class="symbol">=</span> 1<span class="symbol">.</span>0 <span class="symbol">/</span> <span class="type-name">IToF</span> (size n)

  <span class="comment">-- unpack into two scalar fields
</span>  vx <span class="symbol">=</span> <span class="keyword">for</span> i j<span class="symbol">.</span> v<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>(fromOrdinal _ 0)
  vy <span class="symbol">=</span> <span class="keyword">for</span> i j<span class="symbol">.</span> v<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>(fromOrdinal _ 1)

  div <span class="symbol">=</span> <span class="symbol">-</span>0<span class="symbol">.</span>5 <span class="symbol">.*</span> h <span class="symbol">.*</span> (divergence vx vy)

  p <span class="symbol">=</span> snd <span class="symbol">$</span> withState zero <span class="symbol">\</span>state<span class="symbol">.</span>
    <span class="keyword">for</span> i<span class="symbol">:</span>(<span class="type-name">Fin</span> 10)<span class="symbol">.</span>
      state <span class="symbol">:=</span> (1<span class="symbol">.</span>0 <span class="symbol">/</span> 4<span class="symbol">.</span>0) <span class="symbol">.*</span> (div <span class="symbol">+</span> add_neighbours_2d (get state))

  vx <span class="symbol">=</span> vx <span class="symbol">-</span> (0<span class="symbol">.</span>5 <span class="symbol">/</span> h) <span class="symbol">.*</span> fdx(p)
  vy <span class="symbol">=</span> vy <span class="symbol">-</span> (0<span class="symbol">.</span>5 <span class="symbol">/</span> h) <span class="symbol">.*</span> fdy(p)

  <span class="keyword">for</span> i j<span class="symbol">.</span> [vx<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">,</span> vy<span class="symbol">.</span>i<span class="symbol">.</span>j]  <span class="comment">-- pack back into a table.
</span></div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> bilinear_interp (_<span class="symbol">:</span><span class="type-name">VSpace</span> a) <span class="symbol">?=&gt;</span> (right_weight<span class="symbol">:</span><span class="type-name">Float</span>) (bottom_weight<span class="symbol">:</span><span class="type-name">Float</span>)
  (topleft<span class="symbol">:</span> a) (bottomleft<span class="symbol">:</span> a) (topright<span class="symbol">:</span> a) (bottomright<span class="symbol">:</span> a) <span class="symbol">:</span> a <span class="symbol">=</span>
  left  <span class="symbol">=</span> (1<span class="symbol">.</span>0 <span class="symbol">-</span> right_weight) <span class="symbol">.*</span> ((1<span class="symbol">.</span>0 <span class="symbol">-</span> bottom_weight) <span class="symbol">.*</span> topleft  <span class="symbol">+</span> bottom_weight <span class="symbol">.*</span> bottomleft)
  right <span class="symbol">=</span>        right_weight  <span class="symbol">.*</span> ((1<span class="symbol">.</span>0 <span class="symbol">-</span> bottom_weight) <span class="symbol">.*</span> topright <span class="symbol">+</span> bottom_weight <span class="symbol">.*</span> bottomright)
  left <span class="symbol">+</span> right
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> advect (_<span class="symbol">:</span><span class="type-name">VSpace</span> a) <span class="symbol">?=&gt;</span> (f<span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a) (v<span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>(<span class="type-name">Fin</span> 2)<span class="symbol">=&gt;</span><span class="type-name">Float</span>) <span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  <span class="comment">-- Move field f according to x and y velocities (u and v)
</span>  <span class="comment">-- using an implicit Euler integrator.
</span>
  cell_xs <span class="symbol">=</span> linspace n 0<span class="symbol">.</span>0 <span class="symbol">$</span> <span class="type-name">IToF</span> (size n)
  cell_ys <span class="symbol">=</span> linspace m 0<span class="symbol">.</span>0 <span class="symbol">$</span> <span class="type-name">IToF</span> (size m)

  <span class="keyword">for</span> i j<span class="symbol">.</span>
    <span class="comment">-- Location of source of flow for this cell.  No meshgrid!
</span>    center_xs <span class="symbol">=</span> cell_xs<span class="symbol">.</span>i <span class="symbol">-</span> v<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>(fromOrdinal _ 0)
    center_ys <span class="symbol">=</span> cell_ys<span class="symbol">.</span>j <span class="symbol">-</span> v<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>(fromOrdinal _ 1)

    <span class="comment">-- Index of source cell.
</span>    source_col <span class="symbol">=</span> floor center_xs
    source_row <span class="symbol">=</span> floor center_ys

    <span class="comment">-- Relative weight of right-hand and bottom cells.
</span>    right_weight  <span class="symbol">=</span> center_xs <span class="symbol">-</span> source_col
    bottom_weight <span class="symbol">=</span> center_ys <span class="symbol">-</span> source_row

    <span class="comment">-- Cast back to indices, wrapping around edges.
</span>    l <span class="symbol">=</span> wrapidx n  (<span class="type-name">FToI</span> source_col)
    r <span class="symbol">=</span> wrapidx n ((<span class="type-name">FToI</span> source_col) <span class="symbol">+</span> 1)
    t <span class="symbol">=</span> wrapidx m  (<span class="type-name">FToI</span> source_row)
    b <span class="symbol">=</span> wrapidx m ((<span class="type-name">FToI</span> source_row) <span class="symbol">+</span> 1)

    <span class="comment">-- A convex weighting of the 4 surrounding cells.
</span>    bilinear_interp right_weight bottom_weight f<span class="symbol">.</span>l<span class="symbol">.</span>t f<span class="symbol">.</span>l<span class="symbol">.</span>b f<span class="symbol">.</span>r<span class="symbol">.</span>t f<span class="symbol">.</span>r<span class="symbol">.</span>b
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> fluidsim (_<span class="symbol">:</span> <span class="type-name">VSpace</span> a) <span class="symbol">?=&gt;</span> (num_steps<span class="symbol">:</span> <span class="type-name">Int</span>) (color_init<span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a)
  (v<span class="symbol">:</span> n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>(<span class="type-name">Fin</span> 2)<span class="symbol">=&gt;</span><span class="type-name">Float</span>) <span class="symbol">:</span> (<span class="type-name">Fin</span> num_steps)<span class="symbol">=&gt;</span>n<span class="symbol">=&gt;</span>m<span class="symbol">=&gt;</span>a <span class="symbol">=</span>
  fst <span class="symbol">$</span> withState (color_init<span class="symbol">,</span> v) <span class="symbol">\</span>state<span class="symbol">.</span>
    <span class="keyword">for</span> i<span class="symbol">:</span>(<span class="type-name">Fin</span> num_steps)<span class="symbol">.</span>
      (color<span class="symbol">,</span> v) <span class="symbol">=</span> get state
      v <span class="symbol">=</span> advect v v          <span class="comment">-- Move velocities
</span>      v <span class="symbol">=</span> project v           <span class="comment">-- Project to be volume-preserving
</span>      color&#39; <span class="symbol">=</span> advect color v <span class="comment">-- Move color
</span>      state <span class="symbol">:=</span> (color&#39;<span class="symbol">,</span> v)
      color
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><h3>Demo</h3>
</div></div><div class="cell"><div class="code-block"><span class="type-name">N</span> <span class="symbol">=</span> <span class="type-name">Fin</span> 50
</div></div><div class="cell"><div class="code-block"><span class="type-name">M</span> <span class="symbol">=</span> <span class="type-name">Fin</span> 50
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- Create random velocity field.
</span></div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> ixkey3 (k<span class="symbol">:</span><span class="type-name">Key</span>) (i<span class="command">:n</span>) (j<span class="command">:m</span>) (k2<span class="command">:o</span>) <span class="symbol">:</span> <span class="type-name">Key</span> <span class="symbol">=</span>
  hash (hash (hash k (ordinal i)) (ordinal j)) (ordinal k2)
</div></div><div class="cell"><div class="code-block">init_velocity <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">:</span><span class="type-name">N</span> j<span class="symbol">:</span><span class="type-name">M</span> k<span class="symbol">:</span>(<span class="type-name">Fin</span> 2)<span class="symbol">.</span>
  3<span class="symbol">.</span>0 <span class="symbol">*</span> (randn <span class="symbol">$</span> ixkey3 (newKey 0) i j k)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- Create diagonally-striped color pattern.
</span></div></div><div class="cell"><div class="code-block">init_color <span class="symbol">=</span> <span class="keyword">for</span> i<span class="symbol">:</span><span class="type-name">N</span> j<span class="symbol">:</span><span class="type-name">M</span><span class="symbol">.</span>
  r <span class="symbol">=</span> <span class="type-name">BToF</span> <span class="symbol">$</span> (sin <span class="symbol">$</span> (<span class="type-name">IToF</span> <span class="symbol">$</span> (ordinal j) <span class="symbol">+</span> (ordinal i)) <span class="symbol">/</span> 8<span class="symbol">.</span>0) <span class="symbol">&gt;</span> 0<span class="symbol">.</span>0
  b <span class="symbol">=</span> <span class="type-name">BToF</span> <span class="symbol">$</span> (sin <span class="symbol">$</span> (<span class="type-name">IToF</span> <span class="symbol">$</span> (ordinal j) <span class="symbol">-</span> (ordinal i)) <span class="symbol">/</span> 6<span class="symbol">.</span>0) <span class="symbol">&gt;</span> 0<span class="symbol">.</span>0
  g <span class="symbol">=</span> <span class="type-name">BToF</span> <span class="symbol">$</span> (sin <span class="symbol">$</span> (<span class="type-name">IToF</span> <span class="symbol">$</span> (ordinal j) <span class="symbol">+</span> (ordinal i)) <span class="symbol">/</span> 4<span class="symbol">.</span>0) <span class="symbol">&gt;</span> 0<span class="symbol">.</span>0
  [r<span class="symbol">,</span> g<span class="symbol">,</span> b]
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- Run fluid sim and plot it.
</span></div></div><div class="cell"><div class="code-block">num_steps <span class="symbol">=</span> 5
</div></div><div class="cell"><div class="code-block"><span class="command">:html</span> imseqshow <span class="symbol">$</span> fluidsim num_steps init_color init_velocity
</div><img class="plot-img" src="data:image/png;base64, R0lGODlhMgAyAPIHAAAAAP8AAAD/AP//AAAA//8A/wD//////yH5BAAyAAAAIf8LTkVUU0NBUEUyLjADAQAAACH/C0ltYWdlTWFnaWNrDWdhbW1hPTAuNDU0NTUALAAAAAAyADIAAAP+CLfcWzCGSYO4OF/Cu+fD4DhRWVSWpgLA54bieJgmpa5s63IHHDc0WuqGyeV2C99vFjQZiEXj0cNQxppOw5MolXYa1gG2pC3ful2CwzoZF8pwDbq77PkqWLg+Os/BwDAoAUF6hQJ9RkpVIYJtZIV6BIgsYUkDjRQRkJEciGEhPZh4m3Afc5+BojakWjt0qIyqQ6Q7nX6wl7IakLUdlLiyQxmcvSDAukRlxV92n8FQFwbLPItseILQFzrFI9Z4JzbZU7UyzbkoEsJcRuTldpgl2YdpH+4Moppb62hU9kzwb8ycQUTNXolGAePImaTAnxAUmzIwBADKXROIEedN8lGubswqUhOtjHBzItomW30+ASG55aSvU6gesNQigJepV7BIJnTpQgquXG5YSet1C9Y3QqymUTx29BGtaebCAMz3dFk1bwghCJ2mBpCSYDshbesl4+szoSy4lUuFrObJcfXsnVO1qxDKsQUtPlNBzAszgxDoJmv1kl1XwOmwQRta2Ig/JjVQyMP7CvHDCZPTNl5acaRHdQPHJVJEgmRmv0VJywyqL3SaXyohj1GIo08CACH5BAAyAAAAIf8LSW1hZ2VNYWdpY2sNZ2FtbWE9MC40NTQ1NQAsAAAAADIAMgCHAAAAAA4ACAgFABMAABwAAAAVFxcAADgAACgAJiYAOjoAAAArAAAkAAA3AEoAAFQAAHoAAG8kTk4AaWkASko7AABMAwNEAABZAABpAABxEjRZAFxc/wAA/wMI6RUA/xUA/wAa/wAV1ycAwzsA/zEA/wAo/QI2rVEAmWUAiXUA/0wA/24A/wBK/wBC/wBQ/wB7/wBn/2FjAIkAAJkAALsAAKkAb5AARLoAUK4RAMkAENoAL88ANMsAJ9cAAOgAFOoABPYAAP8AAP8LC/MAAv0TAP8mAP82AL9OAP9YAPVPAP93kpIAq6sA/5MA/4gA/60A/7sA/442xMQA398A/8gA5+cD/+YA//8A/foH//8b//8T//8k//8r//80//87rq5s//9I//9U//9e/956//9s//9+AACGAACYAACqAQG7AACyAGGPAAHDAADMAADZGxveAADiAADzAAD/Bw3/ABL/Fxf/ABvjACb/AD3/KCj/Njb/AFb/AEv/AH7/AGr/RET/Wlr/bW3/e3v/Y2Oo/wCI/wCV/wCn/wC31SmO/wDF/wDO/wDb/wDk+wTs/gD0/wD/+gr//xf/2Cb/xjj//yb//zX//zv//yzRrFL7hHr/mWX//0T//1P//1///1Tt/2//AIOcAP+VAP+AAP+kAP+8AIP/ALL/X5/aeYX/ZZn/apThSrT/VKr/AN3dMs3JAP/FAP/WAMX/ANb/J9f/OMf/AP/nAOT/CO//Fer/AP//Bvf9GObt//+K/f2Y//+t//+l//+7hYX/urr//4/x/67z///C///M8PDWxsb/29v0/8X+/97//+j//////Pr59PTzn5+XAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACP4Aq8iZYMwZGWcFiz3q8qjSo4cQHx0yxCHIQyKPhATZuBEAjQFB5IiUA+CMSABkACBDeaWlM2dZijmL1DAiI4gcKgZxxGEER1IcAURoE3KkUTnFroQB04vXS2fEXlqiCfHmoVwcHgWxsRFRkCEcgxwI4kNDAQBx4Ih0I+eZnCvOrnyB60zmU4iUHiaCKGkUh1xhw9LgmAMAgAYi4TgbuUDOr14ulTkDA9WZsoiYkYCgxRFI4CAAgiAwbKcASbWLX+p52fIKB7gcPGGOiOtRrtuAcyWRE4rjDMPAg9eRsxgZ69ZUWnKIijnTo1l8ce3I/WOjEY4PHgQH8PZKLwDJXv4Ga638g2tIkTrNfpTKNu5cr4KwqQWAgI8AAAZsN7zgiha7cAWoXE6PKGJCC48sEpEkubiXixDXvQLYfh4Bd4UCALTEBV3OUPEEFjkRmNVDhECXCS253PLeHbnIcUsfAORCYXCtkQEXF5ORx0EIHCyy41WP3OLge+8lMSNwAmRI3ktheMdBGCFGqcgkjxjS4JC4mXIHBi0CgMF+LSl5hZhXeOGaFSG6lhMKj3CAQkUNEpniHnjIAcpI3FVAYwLktdSFmhxwkRMLUf711w+54PCeLLnYIkcpIskykp7AMdFna68NmEWhFeUUhAeqCEGkHH60aFQbR6XB5xUGZHBpE/4rAEoFpyFyNAssuRSBGx2lmHqUMwXEAYAEl/b5Gq0oBKETR7UQCelRRx2DBRdnXOFqn008ASgIhfawLEeAbZSiSCZBS9y5WIBBXhMtoQlFExxQRGsQyX4WRCyAHRXISHPQ8RQb/ul4rIgtmACCshWlsNG3OfwmWgVysAWtHuEF8pIvOrr2QZSGcBuECIcoGwQP9kIQGklyBHCSHnL8EQxxT9XhTBjODPNEToDmpIgiOTFiL0cEyBCEfobFUa5Ii60m81NxQeUaMTltnFMus4SiVXU/Dw1AYcBJLEccqzF910uORMFIlKtwQMgjoqBiw3VBxBdUUA4Et4BhckAMc/4wYn/y0kMscBtlIrDgIm4QRMwNwFiLU2hcai8xI/bfzozR5iMvDFoIg7etklviHfmQ334FtJGABXX1Mrklj6j3UI+v/4WVCCbghsttHYE2YwJSQCOAAi7B5VTkzkQ0YpshroKrnBOGdqRhfWbhjOqPFA9J8ZhxwFObPCDxHilrhBvS82ResSHNT1GyySNUPYSVI7konIsNuMnxnhly1EASd8AZUEWxVwCGZa7AuvVE5BYeYF6LZBEEU+EnOBhaQrGccoVOKIIT2JsNlVDBiFyMQk6mkAMd9iASSgFnAhYiT6xg8wFOxMCA7VHge+hglAWUAm8AcAYADNCSVbWLA/7sulwGL8eeRzRLhvYzVxsu4IwLXOF/lyLBFT6gAjUp6BFrC9IjNIEKIiXhNrewRYv4IAcy3mEkcKAAMn5RLDQNLESvewgrnBOn96jBV2U0lzME8QcBYaols+KACqT2CBMQ6BFUwkSKFNgKc40Ef08xH3mg0JKbhYhQPHqECx6xCkzcLheZkFMG6NAHR4qkDuEJWFyuYIwrkGAFtAKBCE7wiF3MQoYbMBX/9AizyfjCGV3QgnJIQKsQ5eIGj3DFbZRAJA1wx2t/ONdIHic2HYFoXhz4wQ1csYtchIJIppBRBtIAgAxwRw7IgBkgnBG2SCaomDnpAAdIhrjcNLCBYv6UAxv4dwHTiCQPf/jDSwQhNku8RIrwDMIOlqWRIHgvFzSUgxgvAAA0GIA7FMiDHOqwtMltYhPOuMTrYMCBs3nAUwoLiwdldJtYjAQNhnkDAAYBADY4g5pMA+kjChiFtXHqBBW5gb2O0CUZ7Q8AUggAFxgQF2Ew7XovuczfLFHSHbWgBzaY50awFhZYBGEBa8jASBpgocWUaXKSM+hDXgARRWBxByddWGdk4IDO2EItcjCJYSbAhGFdoQuTKx4xhsEMzEUkEYngmU6+tZF9bgcNajjqMwRQoytkQSkvoZ4BH9GIVMCiIr0JTBw6MoMc6A5vDZDAEgDABDNdwRfG8EPFLztRvAyW4BElYAERHbEKi3BEBqHBQBCAIAc1AKcCFXAsAKoAjNb84hlPUU/xCouTy40ICaHdyCk48sCjkuQsaQgIACH5BAAyAAAAIf8LSW1hZ2VNYWdpY2sNZ2FtbWE9MC40NTQ1NQAsAAAAADIAMgCHAAAABAgEABkAFhYCAAIXCRMWACsAADYALS0DAAApAAE5ABMxACcyAEYCAFYGAHYAAGQGAGQySEgAUFALdHQHbm4qAAFFAABYABpQADJKJiZMAgJlAAF6EBBvIzNtAF1laGhd/wEA+gcE/xYA/QIV5hkE1ycCyTUM/yQB/zgA/zkS/wAn/wA2/xkk/zMvyzM5r08AiXUBlmgBm2Mn/0UA/1UA/2oA/3YB/3Et+wRG/wBW/xVH/wBr/wB6/xZ1/zRw4StTqFZ3lmhYAIgAAJYBAKkAALYADactbpAEVKoBSbYAVKs2AMcAANgALtABAeoAFugDAP8ABfYCAP0VFegUCdcyAvw4B/QtLdEoAK5OAZJwAKlpTbFGZphdAP9HAv1XCedKAvtzG9NfhYUBlpYEqqoCl5cu/4gA/5kA/4IX/6YB/7oA/6QV/6op0dEC/9AA6ekD/+kA//4B/PgF//8W/+Ma//8o/f04+ekt1tY5o6Nl/65R/f1H//9X7+dK//9o//98//9y489gAAGJAAOWEBaTAgW4Cw6vJSyUAGSMdHSPX1+pAQHJAwPbABvXAQLmAADzAAD/BAv9ABn9Fhb9ChnmADf+ACb5Jyf/NDT3ACnWAFb7AEn3AG78R0f9WFj9eHj9amr/YmLK/gGJ+wiX/AOo/we4/zOjpFqo/12n/wDH/wDV9xHU/gHs/wLl/wH/+Qj85Rn//xX//xv98RPs0C7+/yn+/zn+4SnTqVX+u0P7lmj/inX9rlDW/0X+/1T//3j//2P//1TUAJmka5OcAP2WBfORAP+mAf65DumnIsueAJn8AIv4AKz+AI3Qb4/2UK76apTTMM7RAf7JA/rbGuXKANX+Bs34MszuAP3oAOr+AfX/AP7/BPr3EufyAM3RoqKp//+L//2Y8OGd/v6p/v616+uo9NyWkJD/raz+ra3M/5f+/5H0/7X//6T4/6Lb///E//3T///b7ejOyMj/19f//9j9/8n6///p6Oj+/+f+//7//Pj6/+bv3s7S/7SNCP4AweGp4McPnzn44L07xw6WLVgQIbaCtUoIKSldaMESIkKKRylGjjh4UCULJACQDDGCRECDvwmC+PAJF4gcn3393tnTOCtiRGKjSPSgYooUlyRdPHq5IoUJhAhDsgyK5ClBpEaQ0qWL58/cHT7l4u0T648fRFmwWk2ciAtWMWJYPlIx4fGJFLsAPhxJZMjRo0yPIiGKNGdevDl59uWLdwefPnHuespylTZiNCFCkkxBlkTIx7semxDIkIAApEOZQEmi9EhUJnx05pwJZ0McP3y++LXzGbFXLmPEsCWzEkaKFinKPBqRIqAJAAsAGAyCxChTpnT88pl7JkeOHTl3WP7Is5fq10TesWLBGuUtebdpV6wkrxL6yQMACQAAkJMpEjhK9OQDzzzozCHHDQaWw04L99yCVkTPpAcLKM/wgsU0x1BDhRURFBMBAE0IYEAA+gGgwAZ5kFGGIHrsw48c4eyDxxxovCFCKiGwM8solaEHijfcHFMMMmBkw6EBAkjRgAACkAjABRoAQAECcAByxx+AyFFOOW/4MccNOPYwyimt6AJRLRDtoksuuXDj5hRhgPENAcUAMAQAApRY4gAASEABHXzQAQggdQSCQxw1hDACCyHw4MMzuJSyCiwRumkpN9Z8A4AxxjBAgJ4AuKHnABPIUYYcdJSDTzl83DGHDf42pBBCCCWUQkItuOjSSjdtXupmN9dsQ4gCoOo3gX6iGljqHH2IQ1M4IbTRxqwrkEDKKDnswMIzvewCTSy+ctOJNdY4QgAhBHy6p34SdOeuHAbeIU4abIRQAxqJzmoCLbUgkYwYu3izDTfaaMPNNstsEonCkUQyCCGlfUpBGWWM8e4bdNTwRgriKDqrGrPaYAIuIRAjBhfCXdqMNcxY04kzl0QiScMcbLCBfmRMYAYcbrwLrxwpyDHCDSjMajQMJYASAxVSJKNMN9Rwswk3y1zCcCTLRAIJJA1vQEgZcBQABwhwvItGHG8gSsMIIxQ9Kwy0KuHRFV94wU02yGC6jP4ky3TScGANR+IPOgggIoGB7r4BrxpxpIBGCDeEoMOsSpgQQwlSQPHRF8h0080x3KzcCSMzBx44KKD4gwgIHtzhM9o01JhCtSIYLUMIUIzxWTbFSMHNNNlw80EypkeCScOYYOIHPYqIQofrjb9xwxpx0GDDDi2QwKjRISAdQ0ceTcHENEQ8kIU2WfxNFSaSzEzJJ/vUA4oeZcvxjxxn1DDCrGvswAMLIliBCGCABCQ4YQRQUAISNOcRIjiwCUNggMMa0TDSHSISoMiHYsaihxfdgGhx4J7HTiCCzHQBCTKAQgyc4AQkfGYIBsDPIyAxHeMVIhOeCAUlKBGKfPADHf75CAcdBDECH+DABSR4Qe1WEIJeiGAGQJhCFKgABQZ+pHwNaAARAECIC3CAa4+gRDrESI8M7sNF6HBRKvCQgxYYLQizykUyWIEFLkDBC8Vpil0+8gAIQOA++LlAJBghM094gh78yMQZ7bEPYIBCHOw4hQ5IwSgSBAEV0ZCGKLCwBCmEYQpf+EwRmCCFEMWwRAS4AAEsUAhwYOIP+wjQGfVhD3uwYx/BCEEpVCGCXupgFNXwhhSOgQwshIEaIJECkgxwAGU2YUSgMgQI1LGIfcgDO/w44z7WYY97wOIULmjFKCYXAhFIIxpBkIY0uGEFYfbuAU8wABEEcB8nAYBUFP7QAAYWUY7uxAMs2mzHLXoCkRW0YhUsWMUKpCECE4ADCAPDRhi44YUvNAACRHgCnvQUAAoEQAIDwMMA4BCoPswBHi7axz1sEQzewEIVL3gBCVAhhGkQw03DsJQXpuGABTwgT6AaAAIGQAGfzUEc5VgHO/SxD1vcIiKjiIUudNCKmVbAGMFzUye+QVFqMCADWywWABAwVJ8dpA/xYAVDZmGLB0WkFj3QhRBmMI0lVEMZbloGNzgxjGRkoQqMKBEhbhaqMpTqXXz4Azn8cA9g/MKtEclFLMQAi1gkgxfT4EbUuNGya1yDG8NIBCQ+oC6c3dNU7zqDHMSxB3cIAxfAcP6IT2KRi1rEohu6CJKb8GqpZszMCpZo2CBKdAiyDmAMFKifHNaAhqGdQRXCGIU7IrIKVVDGtr7qhq+YIQlrTGIS18hAFyPBAVAoAgABmIByhda4FKhhD6dYwSwICosV7OIZuuAFL37VjYG5yRva4AQnZNYwC6xkEB1QBwD0MAfElQ0NzR1BClzgMVtIiiLe2oV+ubELbmjXGduwRiSaYQlLlG4ShJAEJCoBCXQEIh506M4cegYvG+gvBfsLwUtLEYJarGIXuYBGLoB0KW1YYxPBjUSSGzaJhnmiEZ9YhBz+4C41yAHCNPJYCEgwimrxQMe56IJ/oeFfDx+sE5Zocv7xKgiKT/AjHt75zhsAMQcaVC/HIchBOUNgilW0Qsgdzu43vLEJa3CCkEw2nSgksQ9zxAYQdNhHg98gYRHOqqFAIMUzNu2mzFqqG8PohCZmyIkNSMITxgvcJyixwcbAmRyBuEMKZGXpEpiAC05YwjOiEYbMatdN2vjAIAbBAULsUBL9iUQ+AlcPbZ6RH66SQyBoXWsSUmEJysBGNTxcjGlYg2ofcIYhLpAAC0iiEulAXRnfJ8szvmMc/aBDChJFAqPhOQRjkMEUPOkFKxRjSJOwhl41oYBIdCAABEiABw6BCUWiAx2Z0OAZ1/GLW7BDBWogxZ6NRoESJMEJMpBCFP6iIAUrTCNv2+hENzYhCQZc4AIBGAS5A4OJh9PjjOnQpi980Y9gjOAUsAgBAOttgllJIQku3BwYvKCNK3QjEZdoxjAmkQAEAAAcLvHAPFb97JQ2tR2meMcPfhAUHqyg6CKQQQlc6ITPfMEKWsgGBjLQjE48QpULNsME8jAOctyBHuiQRzv2wch2tMMes/jFLFwhi1H0oFonQMIKk8DAticTGcM4AgAGQcgLDOJmZHCDHshBhkBpUx+o10c7+AGMgb4DFjrYgSsqIgO1p7CKVzTCcUQOgSkMkoIKIAAC/lSBO5SjD87O5i3W0XpbTOosqyjFDHCBNBPITQxSiIAUNL7BnCYcoQjDIoACVtInPQzADXZIPzmsGRZ99EMfwACGLSbiihywYBTVXUUmN+QEGEihCAeQCFkAHYVgBAQgAOL3chyQABMwAPBwOK4CD+IQD/jwCxU3D0+1HhChAzrwUiQQAxXCBR4RDRAgBUMAARmgBQEACQFwAAewAat0MwQwARVQBn0gB+QAD+UwgfpwC08lCyslEaugA66wArTAA9GAC2EQBFJABagABk/wBA5QANNxEg7gACsxABygAAEBACH5BAAyAAAAIf8LSW1hZ2VNYWdpY2sNZ2FtbWE9MC40NTQ1NQAsAAAAADIAMgCHAAEBBAcFABcCAQQYGRkHACcBADcDBzAXKSkDNjYDOTkRAAInAQM2CxY9ACwwLi4zAEYBAFYDAFsUAG0AAFM2AGs4WVkARkYIdHQGWFgoAwRHAQpVAAJmCQ5xGDBZAG5UAFxqYmJe/gEB+wcF/xcB/QQY7BUO1ycByDYG/ycB/zYC/zEW/gEn/QI39Rkx5SwppVkAtEoGj28DoF4t/0gB/1YM/2YD/3gA/3gY/2gq/wJa9g1Kzy9M/QR6+Qtr/zJs5i1jqlRMsU12i3Nl/09Xvz8AAIcBAJQGALoCAqwMAK0ubpACUa0DTrAvbpAxANkBDNEHL9AKAOgBAf0BBPYEDu8QAvo5BvAsGs8nAIhpBKNYU6tLbZFlANhSL85LCPRQBPdxHcdukZELp6cDsLAOoqIr/5gB/4gI/7YA/6oG/402/7Aj29sGy8sG/9YA/8oD/+YD/v0B/PYG/fwW8ecQ/9Ms/fwn//038eYmzs4soaFh/6Vbzc1R/v1H//1V7OhQ/Pxo/v54/+h14M9sAQKHAASYABeCAgW4CA6sGy2kAGOcZWWjAQTHCA7RAwTnAQH+Awb4ARj8GBj6ABjiACn6ATD1KSn7Ojr8Ly/oGSvRAE/7AG/5AELRbW3IV1f9Rkb2aWn+eHj/f3/rSkrU9gmO9wmt1Cqy5CyboF+h91ib/gTJ/QTa/xjP/QPm/wH0/gH9+gr95hj7/xb97xDuyDb80yvz/yj7/zb+5jXSsE76hnj+lmj3oV7P/3XP/0b+/1b6/1Dp/276/03UAI6YAK+1AKaUcI6TYp2fANyMB/WSLtCtAvemDPCzI9ueAJD2ALf8AK30ALHYcozQaZX3Rrj+Ua7yU6vSAM/SLdHUAvzXCPHQAMj8ANf8CM/wL8/9A/znAuv8Af3+Avj3Een4qamj/6Sm+/mH/PuY6OiQ/v25//6n49KhtbXVkJD3rar3np7M/4/2/6j+/7r7/6vp8qDb/vvK+vXT0tL6/dD3/vzp6Oj//+f9/v3++/X88ujn79fPCP4AB/FxAqhgn3T/Ev56JQsWrFcQX61qxYNUE1OlaqHigmVKlSlYoESYoETLhkOJEDWCVKiBOz3o1v0BFMjPuXT55slrKCviK1eveJ1q4aJJiFOlmjDBYsUjFSkQKihRwkhSokaOHGGStC5hIHR/6tVTZy+fP3y3YMlyxfbVrFq8NnLxUqVJlCgzmkyRImXKkQEOHIAoJMlR4UeNQI36R0eOnHQ27AVKJ8/fvIWwgLpqNWtXXGNRvlzR42RKFCp7nz5h4ICCIkSHPoGSNFvaKHZz4PwRVCddPXvz6sV76DNWrVzHjmHzkg0Mli5TunyZAuXJEyMAGgxgcIgRI0yX7v7183fvnh04cOKU24OvXK9gtl4RrxWr/ixU1Zp9ScbsypViWnRxABRSIHHEAgwEUMYilzRCTifi2QPIH3Og8QYce5RDjwv03BJfRPTFQospvFjjxTLJZOOfEl1UAIERUhyBHQAAEEBGGWWIkQcf5qRD0x141FHHCzgQUUI5tqjiFkSxvBILLLnoMg042SxjJRgtVlCAAQUUIEAAND6QgQIXJIABHn3cAchY5/DmBhEjiLBDKafUUssqq9QCUS605LJLON58I44WYIAR2ABIeBkAmDQuioAFY5Axhx2A2GGOH2mkQQMJKbTQQg8k1mLKLLTooks4qHqDajjXKEJMIf4fBCCAAAAEYMESBNBY4xhjsBHHOefYc2kda5hRAwkklNCCDqcAcQouUe7iDTWrogrONsRowMACA+gaAAEI0IgBAXG00YYccfhxx0GCnKPCGmuIQEILPpDSAhAzTMNLO9RM4w041YazzTOIFMJBt7oCIIMFCVwQx8NxwCGHGXLgcY4aKeCQghkpiOBxKa4YwwUyylQzjrXcgPPMJpFUMgkkjzhSyAKL2irGzWL4+rDEcKShRiBpqJDCCGeMwKkJQPCCgRdbYNNMOOIIzI0zzzizSSWRaPIIJI5wwEEHGgCAARlksMEGHTtfiIYbbqSgwtsixCnCCUIIcdoXzTQj6P7Az2gSCSUtP/KIJpDAbFUHNz9QrmPouoEGGmm8oQINKSQbpwknoLDEaVV8Ueg32YwDziYsb6L11oILzg4vnSziARl2QPyGHHCgccMNmtbQsQgoFBGDDCfcNYVHyQiaDTMqb7JSJKlLkron5LCzSAgh5DHHDenF4cYbt59BAwsjxDnCCTEwwUQVTKBmxTJfiAO6OOIUM4wiqUPi/COWWAIhOaNY/0cdaDjDGURwgxTUwAUuKIHc4naCE8AABTAYnhVCooQkGEEJ17gGzLJiiftBwhKX0Ic+2qGHOcxhDzZ4Aw1s4LEa1EAHLTCBAscngxgsAQbmW8LwpvAEKhwBAv5IWMARWMIIwTmCEY3ABCju4Y575OMd5ODDHNSwAyK4wQUyDF/4TGACJ3iRCUtYgvmiwIQoDE8KSeDSARjhCEIYDhGeuIQnJCEbffTDHeQ4x3qI4IIVuGAEXPRYCXhggiAEATVVuIsZhScFI0zgRQwghMGM+IlQhMIS+nCHO/jBj0z6ox//2AMpdCC3F4jABcowRQhmUIUrWAEMH+ELFVAzhQlEAAIToBUANLDBUXziHboYoT74sQ9+wMMd6+hFKkpBihKcEhVCsIYxtrCFJlxBNE2ZAoysw5cIGCBh20FQB2zzD0CUhx/90Ac+5HHMVOygB54SQQukYQ1rVEEZzf4Agxc8Zx0jGGACBYiAFEYCgQI0imaI8AA5jHEHe4iHk/wIRjzQIosftEAVpdBB3IwhjXEsghzjEIcXkiGOKxghCREwwpaesChdJSABFniAB1BxDgqpyx4QjYeHIgIUVZCCB8bgQRBewAVUiKMbydAGGL5ghJFMAAkGABOjGIaABJQBD2Jogx1MCAicclIev7gFRFrRClj8tBRCFUIQlGEMcVwjUOJIRjKQoQUKHOBLCatRw84FsUn14R/wgMc6+uGhnrClFa7oQS6I2oxlfEMbUYsG6FBEgQ8IwKA0QhgAEPAodD1sDoDwQyDsIYx1wKOwEaGFMUzRA14YgxdOc/4aqqAxOjAgowKG8EBmwWazMViADA8zAxzuIAh0/OMyviBORHKRC17QYhq00IZ0v/GNcHBjGwMDhzOIkQUQMGAAHQDAAAKgAAsQIFKehYMZzJADNdADF8K4hSx68opWrOIVuagFLbwR0nB8AxzaCAc4UtY3SMyvEpzo1gA4kAgFIIAAkIJYHHBHAhq0NxWnkO9YW1GLXRxHVQGrVt/CEIZKPIIRBeMAIVq3KAxImA5pIMHb1FCDH/ggST9xRQumsYtchIIa1ACHkLuxqmeMjhJYewQlDtEBRhRiFOggAB90FgfHBJByKljBCFjgAx+UwgeuWEUoeGGqdoTjVFDrxv6AKcEyE28tEo7YQFYw8Ql01KMP6JIDG/LsBjOMYHel6AEzdxCLVeRCGtWY1jhOhjLTUULJqYvEIbZWGE+8Q10QW5sZ1maD8HlsWSzwlCpWsQsunGzRq4JfBvv2MsHBLHVaCcU90iGHPvjBD43psxtIsEBnjqAEpFDFLKixC12Mo7qpBkcxBraJrNgvdYJT4if8cQc5+KEe55DDHWzgNo9522OYEwKJpjGNcWQjG9USBzE40QhGVKISiHDeq6ONyX6Y4w5+yEc+8IwHGqjg294mn1K2QE9sZMN9B7cuCCRJiENIQhL5kwQk3AGKR1SyHxDNxz7uYAd8q4AEAAc3Cv5kQAUvKAMb2FhGOLIRDWhwIxogSAQhvssADTTiE4/wRCjasbV2YJwf+IAHPfzhBxv4gdceC98JRFDDJaBgeF94ZYqycQ3sOkMRHWhJA7Y1ikxc4hLuCMUnLAEKiAbjF/ToRQ1w8APwJX0EvhMjE3Y4BVcy47/Q6IYzOLGBDhDgax5YRCMSgQlPtKM87QjFMPexj2CwAh4r+AErROBrLmKOCmScwiyJxwxtXAMcw9CEJkDQgRAQIAMh0EMiFsEOUHyiH/vQxz0g6otfKPMHP4BhC0rARRg8UIdRqAJqnvCFLywjC1kYhjM0sYkODAABehBDGQaxDkCgw5L90Hgx9/4hj3jAwxbA+IFPYWgCFGBABub7yOaRIIUvMKMYFOiAIxqhiUMQggNWJQM6+PCHP/ShPIzHeOskD8FwC/LVCqzQA6tQCkEwA8BTBFGABVEgAajxAUgQAciwDEmgBA1wRIxACB0QABdABniQB3agDucAUfugcd4XD79gC+DXCj1AVmglVFGAATCABddRWR9AARWQBRJQBQNAAQywAYXgCAuQACGwDm3ABnYQLPqWD/UgD/KwD/AAH4glC6WwAzpQCgv4DtiABUzgBEtABUgAASAAAg5QAEogAAagAQugARtACIQwABcQAhmQB1plB+nQh/vwC78QDMg1X0DxCl2oCl0lMAOoIA3HsAUiswVPAAUVMBhZUQEDMAALwAgaoAEDQAAXMDZ5oG1icRPyYAtiZQvw0BOItQqnoAOqYAqkIAS8MATUxAVRkAQSIAEG4AGktwAGEAEbgAiMUIQPEBAAIfkEADIAAAAh/wtJbWFnZU1hZ2ljaw1nYW1tYT0wLjQ1NDU1ACwAAAAAMgAyAIcBAgEECAYBFgMABBYUFggANgEDKQsrKwE3NwMCBSYBBDkAFykANDMsLC8ARwIAVg0AZgMAdwIAexQAUjAAbjBGRgFRUQpvbwVhYi4DBEgFBVgWFlIAJVABAWkBEG0ANm4xMmYqKk0AU00Aa1QAUnF0dHG/PwH+AgH6CAX+GQP7BBfrFA3HNwHWKAj/JwH/NwH3Mw/9Aif8Ajr1GDHsMjKpVQaYZgOJdQWiXDP/RQX/UQ//aAP/dg3/US7/byz6CUz1D3HaMV6zS1SwTmuNcWP/XVwAmQMAjAwEsAgAjDQcsx1vjwFItgJPrw1xjTJRrS1fnxQA2QIEywkxzQQD6AMW5wIC+AQD+BYQ5xcByi4xzCwG8jAAjVIAunMArlJPr09yjF8F9E8I8G4d0laNjQmrqwmvry2QkDD/mQP/jAn/qQL/uQP/shP/iSf/sCXOzgv/yQH/2QL/0hr+5gP9/AD79AT8+hnp5wrX1y7/0jD9/Cj/+zj27CuRkWH/oFrR0U7/1Ur9/Ej9+1n37VL59XHR0XIAAYgAB5cJFZQBB6YJDrY2NqgVK5kAZqNhYaYDBccLEdMsLM0DBOgBAv0DBfUBFvwWFvkRF+kBJvwAO/oEK+woKPo0NPIAMM0AUvYAbvcAXM9JSfpZWfxQUOBubvthYcn+AofxEJL/K473DrHZKKerU4uMcpSoVq//c671VZr8BNj2Ds78BOr+AvX+Av38CvzlGf3/F/ztFvDQLvX/KPv/NPrUKtavT/WGePyWaPejW9L/SPv/Wvn/eP7/ZfL/VNMAjK4AtbAAn5ZyjI9KtLRinKgF8ZQK8K4czpsAivsAuPoArPYArsRtkflQrvleoMsC0tYvz8sC+9gL8dEAyPoA1/kJ0O0vz/sD+egE7PoB/P4E9/kN6PaQkLGlpaT/pJ7W1o79+ob69pbU1Lf//an+/bj+6Lf/ypWNjfiurfilpc3/lNj9hfz/kPT/rPr/tvnYquzT0Mv/08/89dDQ0Pz/0Pb95/3+/P789vvx7/AI/gALFTJDqGAgdezw4dtVSxetWrQi1pIlK0iQVURS8WqV7IuVj1KiPEiShYsHD4sUPaKUaEM6cubMFRJ07hwhdfnq1btFiyfEWkB7qfrx40mJU6qINGmy5YqVK1QKTDiSBBIkRpAkSdoUaVy6QYTOCSLEDqe/f/WEPQQ6a5YsXsCGjPvyRYuWJ1qcOKlC5aORABwojHh0yZIlSZYuiRp1z04dPucAsTunbh++esTWsrWVyx3GMWK2PHlSZYpTK1SoRFmwYEKjQ5dCido0LRS8Uu/42AkEqB27dfks7wQqkXOvZdWuicEWRosXK13CoI4S5cgA1ohUQuIU6t9Zdvf0/sSJY8dPOVdF4sUL9rOWrfe2NlYDzYxZmC1dvHh5EEGKFCMDJDBAH45sIkkfXq2zTkFywBEHIOa5MoMrxTAElHvv5aIKMMqIUR82YlyRhRdJOACBEUgYIYCAGJxxRhlkmGEGWGHtMUgebvjQQw8quKJLLLPYAhRP7/VCyjTdYNNMM8yIIcYIDBjggBEQQAAAAAFUgEEFCFRwQRl46EGTTYDkwUYOKajwQyqx9MJLLLgIaVwvv4AjjjfecNGFGCIsIKUBAghw5aAHIPDlG3yISdMgbKiRgwspxPADUq3wokouvUwzDTjghEONOJ2KY4wxH3wQgACACmDBBQcMWkEZ/m/UYYdN66BDyCBtoMFDCmnKAMQrQQzBSy/u+EINNZwmG8420miQgQIDENolAVkiUMcbdNRBRx567GHrOT3wwEYKKPwAhClADIHDNL+408001HzzTaecahPNIYpoEMCgABhqwQEVaEsHHXPUMR4f6PiRgw4vpJHCCSeowCYYXzizTDeggrONNto8k4kmmXgyCSWPZDBAAAEQUAEZMJKB7cBxzDGHGm0Q4ugLLjzKawunrPLEGF9c40w44YCjDTTQRPOJJ5hUksnIJXfQgb4vvmH1HQPDsYbWccDhwgs4P3wCCsEOUcUWYjjDjDffHP2MJ5U0XcnImExiN1eLkEHG/gWOEVxwHGuggYYaL+SAswoPr9BCDU1IYcUWYYjRDDbifPPJ0ph44gklI9ttNzzjjLMICGfgUQccdMSROhxp8JDGDmCPzcLsNdgwRRVPhTG5N9hksw00nWRVt92WeM7JOPc44kgJfMjBRh11zOECGjvswMMLMaCAwgkrsGADGUxMAUUVV0TuTTi8n3+MMaB4Pknxk2zCSSn63IZoG2moUX0KYPcwwwwqgNjYWmCCG9ygdh8JAxaykAUqGcEZx9AEJSRBCcNwjhKbCMU79DEOM9iBD27ogY52oIKc0UAGKljB9rRXAxPY4AZLWMpHUkMFJEyJA4mQxCEeIYlJSIIw/pEQxTs2qI93mAMPeSgCDXqghhRqTwUqQEELcIADJzwBClBYwhKYEL4q4C4KUnCAAwygCB1SooKKEIUoQsEJUZBCH/6onznwUY4iAEEGEFvBCiCmghlM0QlXuAIWptDFKRiyhhBwQAQWYIhEGIJ4nCCFJIf4Dn+cRR/3+Ac+/JAKUwTwfycIQivUVYIrbAFyV/BiaqyAuwhAoAAQ2BcAEmA3SpRiFPCARxH1wQ9++MMe9rhHMV4BhBhAcRWjVAYYwGBFyJ3yI0eQAg2tYIQCyBIAAVKABjbAinHk4x5FtCQ/6kEPedgDCDRIBRCgiBxlLGMZysiGGEAThiogIZER/oBlFCIQgTFeiQAEyIAhQECOcdwBHf/wjj/4IY96yOMWsTiFW07xAxUMgRXd2EIykiGObNAzRRE4ggEKEIEoCGpQCABYA0BQgnMMwg67yYcl/TGPXTiEFm6BBRDKJoSeloAV4GiG5JiRhQfwJwLVPGm/uHQAC5jhDme4A0xjOtN6DOOmspgFLlQBBFUIgQhgEEIzknENbnzDG82IXBe6MAEHCOCaKCMAAspwB4HRIRCBEMQ+5BEPdqxHFzyhBTB4kYpTsEIIyVDGNbKRDaJxg3f1mUCUDIClAEQLSwc4wAUGRgc76CEs58BHMfAxjGDswie5cAQwCsuhxTbjGs3g/hQ3tnEMZnRhBBxYwJUSoIEEGOpLFihD6tQQOD+0Ax/zIIaFIkILWfSiF7n4BTWmcb70fWMbvzvaMY4xAhIoIAPPOlkDKhCAMtB1YHMQHAx84IpXVOgWgaWILaDbC4wRTRxEa5s2vgGNT4ACGY1ohAcGMAAFoKQBmf0SZ+vAgx24QAc+8AEqUHHaiMgiFr/4BaYwxqk7JYtT/f0vKDShiEMcogOMIEcJrrRZzsYBDTh7gQ9gQAMg6CIVsACKDFaR4V90gxpFWxan+BuOZ2ACE43QRCUegYhHKCIS5mjAH+o6MG2tYQ27egG5gMBldcICFr8AxjR8MY1w+GLI29BY/sjiNolKuLkSiYANdygTCDtk6w51PV0aUPAwFaALXUDABYar8alP4bdo2H1bJtxsNzdLoowTFGIg9MBZBxF3DTnYHsR+IIMYyMAUX/7FxcRx6KJ1yhqo/kQmOFfLR9htK0LMx27E4hg4EFdsAoyYCk4BJ2r4whd3IpqwvWEMaShNEz2En+cs0UZ3CGI3tfIs7F6QawEqbggb0tSdsIG+ZEmjE4qAhCY0AQllL5sT3kFHXtXxD3XUQQ47gIGmc90CGzThLslZLPqyYVZukMAQJraKIjZhCc6Jwh0ED4UvLZmPf+xhDx+EVK63x4IWsOACV9CCM5xxDWaAAxvW4Fg0/kiQCA8o4OQKGLglNkEKd3CC5Qp1aDzyIQg3BCIHE28BCi5wAzLU4COn/BDIOWYMAW8TvCCIRCQsEYpiiWISopipPIQxD1e0gQdFmEGuu8e48H3kI1fwENugYY1ngIIDHmhAA0IAgkUonTvu+IcvNiEKOPaSGMVwRQ+KgApj5jEF9WZCFQQPdrQ1Y7vcMIbmPhACDJgBAwRaRCmm4cZevmMacKSpMIjxCnPd0Zjds4ENasAEVuKOCmEIQ31GcAxkLO0TJq/AGczwB3MQQhDpkOQ/eulLfuxVHsEoBirUyenukcEGS7gdEpBgBS5IU3fISEIGOqEJT0BiasEVCB7w/mqODfKe91YVhk1T0UlYnEIIOLABC0wwBS1UQQJRoMIIjsCF+iTh3yp5hCE6QAAMvAEPYYIO6zBTZ7EP9DAP9CB+u4ALsIBjDRgE6PcEN2A7UnAEEzACIjABEJAEEyAFkpUBHdBIGkAAJdAHVrMHwMFw+UAP9cBQw3BassCApjAphdUKyjAGUOAES6AERvAAGOgBFHAEEBABJ6cBIWgIA4AAGIADZvAGehAIwBEcwhAMwzAMxBAMgDULzSULppAKMYADq1AKy/AFy6QERoWBiPBDBJYAhlAyJqMyjocHnqUg6qAO9aALutAQVzURbsFVpsALpxAEwMAKdlEXSiABFQ/AACPQCBpgAA+wABmALxuwAQ0QEAA7"></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="prose-block"><h3>Gradient test</h3>
</div></div><div class="cell"><div class="code-block">target <span class="symbol">=</span> transpose init_color
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="comment">-- This is partial
</span></div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> last (xs<span class="command">:n</span><span class="symbol">=&gt;</span>a) <span class="symbol">:</span> a <span class="symbol">=</span> xs<span class="symbol">.</span>((size n <span class="symbol">-</span> 1)<span class="symbol">@</span>_)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="keyword">def</span> objective (v<span class="symbol">:</span><span class="type-name">N</span><span class="symbol">=&gt;</span><span class="type-name">M</span><span class="symbol">=&gt;</span>(<span class="type-name">Fin</span> 2)<span class="symbol">=&gt;</span><span class="type-name">Float</span>) <span class="symbol">:</span> <span class="type-name">Float</span> <span class="symbol">=</span>
  final_color <span class="symbol">=</span> last <span class="symbol">$</span> fluidsim num_steps init_color v
  sum <span class="keyword">for</span> (i<span class="symbol">,</span> j<span class="symbol">,</span> c)<span class="symbol">.</span> sq (final_color<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>c <span class="symbol">-</span> target<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>c)
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block">init_vel_grad <span class="symbol">=</span> grad objective zero
</div></div><div class="cell"><div class="code-block">
</div></div><div class="cell"><div class="code-block"><span class="command">:html</span> imshow <span class="keyword">for</span> i j<span class="symbol">.</span> [0<span class="symbol">.</span>0<span class="symbol">,</span> init_vel_grad<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>(0<span class="symbol">@</span>_)<span class="symbol">,</span> init_vel_grad<span class="symbol">.</span>i<span class="symbol">.</span>j<span class="symbol">.</span>(1<span class="symbol">@</span>_)]
</div><img class="plot-img" src="data:image/png;base64, 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"></div></div></body></html>